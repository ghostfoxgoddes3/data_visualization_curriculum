
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. Composição de Múltiplas Visualizações &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=720ed60b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=fb9458d3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=720ed60b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/theme.css?v=a243ae73" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_sources/content/curriculum/5_compo';</script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/copybutton_funcs.js?v=776a791e"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/language_data.js?v=d4673a71"></script>
    <script src="../../../_static/searchtools.js?v=63a53a7d"></script>
    <script src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../../_static/scripts/bootstrap.js?v=7583a70d"></script>
    <script src="../../../_static/scripts/fontawesome.js?v=9b125980"></script>
    <script src="../../../_static/scripts/pydata-sphinx-theme.js?v=a1eb5d9f"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../content/curriculum/intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/impatech.jpg" class="logo__image only-light" alt="My sample book - Home"/>
    <img src="../../../_static/impatech.jpg" class="logo__image only-dark pst-js-only" alt="My sample book - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../content/curriculum/intro.html">
                    Introdução
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">CURRÍCULO</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../content/curriculum/1_intro.html">1. Introdução ao Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/curriculum/2_types.html">2. Tipos de dados, marcas gráficas e canais de codificação visual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/curriculum/3_trans.html">3. Transformação de dados</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/curriculum/4_scales.html">4. Escalas, eixos e legendas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/curriculum/5_compo.html">5. Composição de múltiplas visualizações</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/curriculum/6_inter.html">6. Interação</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/curriculum/7_geo.html">7. Visualização cartográfica</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">SUPORTE</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../content/support/debugging.html">Guia de Depuração para Altair</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/executablebooks/jupyter-book/blob/master/docs/_sources/content/curriculum/5_compo.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F_sources/content/curriculum/5_compo.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/_sources/content/curriculum/5_compo.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>5. Composição de Múltiplas Visualizações</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dados-meteorologicos">5.1 Dados Meteorológicos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#camada">5.2 Camada</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eixos-compartilhados">5.2.1 Eixos Compartilhados</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graficos-de-eixo-duplo">5.2.2 Gráficos de Eixo Duplo</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#faceta">5.3 Faceta</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concatenacao">5.4 Concatenação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#repeticao">5.5 Repetição</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#algebra-de-composicao-de-visualizacoes">5.6 Álgebra de Composição de Visualizações</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resumo">5.7 Resumo</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="composicao-de-multiplas-visualizacoes">
<h1>5. Composição de Múltiplas Visualizações<a class="headerlink" href="#composicao-de-multiplas-visualizacoes" title="Link to this heading">#</a></h1>
<hr class="docutils" />
<p>Ao visualizar vários campos de dados diferentes, podemos ficar tentados a usar tantos canais de codificação visual quanto pudermos: <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">color</span></code>, <code class="docutils literal notranslate"><span class="pre">size</span></code>, <code class="docutils literal notranslate"><span class="pre">shape</span></code> e assim por diante. No entanto, à medida que o número de canais de codificação aumenta, um gráfico pode rapidamente tornar-se desordenado e difícil de ler. Uma alternativa para “sobrecarregar” um único gráfico é, em vez disso, compor vários gráficos de uma forma que facilite comparações rápidas.</p>
<p>Neste capítulo, examinaremos uma variedade de operações para composição de múltiplas visualizações:</p>
<ul class="simple">
<li><p>camada: colocar gráficos compatíveis diretamente uns sobre os outros,</p></li>
<li><p>faceta: particionar dados em múltiplos gráficos, organizados em linhas ou colunas,</p></li>
<li><p>concatenação: posicionar gráficos arbitrários em um layout compartilhado, e</p></li>
<li><p>repetição: pegar uma especificação de gráfico base e aplica-lá a vários campos de dados.</p></li>
</ul>
<p>Veremos então como essas operações formam uma álgebra de composição de visualizações, em que as operações podem ser combinadas para construir uma variedade de exibições complexas de múltiplas visualizações.</p>
<p>Este capítulo faz parte do <a class="reference external" href="https://github.com/uwdata/visualization-curriculum">data visualization curriculum </a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">altair</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">alt</span>
</pre></div>
</div>
</div>
</div>
<section id="dados-meteorologicos">
<h2>5.1 Dados Meteorológicos<a class="headerlink" href="#dados-meteorologicos" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>Estaremos visualizando estatísticas meteorológicas para as cidades americanas de Seattle e Nova York. Vamos carregar o conjunto de dados e dar uma olhada nas primeiras e últimas 10 linhas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weather</span> <span class="o">=</span> <span class="s1">&#39;https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>location</th>
      <th>date</th>
      <th>precipitation</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>wind</th>
      <th>weather</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Seattle</td>
      <td>2012-01-01</td>
      <td>0.0</td>
      <td>12.8</td>
      <td>5.0</td>
      <td>4.7</td>
      <td>drizzle</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Seattle</td>
      <td>2012-01-02</td>
      <td>10.9</td>
      <td>10.6</td>
      <td>2.8</td>
      <td>4.5</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Seattle</td>
      <td>2012-01-03</td>
      <td>0.8</td>
      <td>11.7</td>
      <td>7.2</td>
      <td>2.3</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Seattle</td>
      <td>2012-01-04</td>
      <td>20.3</td>
      <td>12.2</td>
      <td>5.6</td>
      <td>4.7</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Seattle</td>
      <td>2012-01-05</td>
      <td>1.3</td>
      <td>8.9</td>
      <td>2.8</td>
      <td>6.1</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Seattle</td>
      <td>2012-01-06</td>
      <td>2.5</td>
      <td>4.4</td>
      <td>2.2</td>
      <td>2.2</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Seattle</td>
      <td>2012-01-07</td>
      <td>0.0</td>
      <td>7.2</td>
      <td>2.8</td>
      <td>2.3</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Seattle</td>
      <td>2012-01-08</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>2.8</td>
      <td>2.0</td>
      <td>sun</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Seattle</td>
      <td>2012-01-09</td>
      <td>4.3</td>
      <td>9.4</td>
      <td>5.0</td>
      <td>3.4</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Seattle</td>
      <td>2012-01-10</td>
      <td>1.0</td>
      <td>6.1</td>
      <td>0.6</td>
      <td>3.4</td>
      <td>rain</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>location</th>
      <th>date</th>
      <th>precipitation</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>wind</th>
      <th>weather</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2912</th>
      <td>New York</td>
      <td>2015-12-22</td>
      <td>4.8</td>
      <td>15.6</td>
      <td>11.1</td>
      <td>3.8</td>
      <td>fog</td>
    </tr>
    <tr>
      <th>2913</th>
      <td>New York</td>
      <td>2015-12-23</td>
      <td>29.5</td>
      <td>17.2</td>
      <td>8.9</td>
      <td>4.5</td>
      <td>fog</td>
    </tr>
    <tr>
      <th>2914</th>
      <td>New York</td>
      <td>2015-12-24</td>
      <td>0.5</td>
      <td>20.6</td>
      <td>13.9</td>
      <td>4.9</td>
      <td>fog</td>
    </tr>
    <tr>
      <th>2915</th>
      <td>New York</td>
      <td>2015-12-25</td>
      <td>2.5</td>
      <td>17.8</td>
      <td>11.1</td>
      <td>0.9</td>
      <td>fog</td>
    </tr>
    <tr>
      <th>2916</th>
      <td>New York</td>
      <td>2015-12-26</td>
      <td>0.3</td>
      <td>15.6</td>
      <td>9.4</td>
      <td>4.8</td>
      <td>drizzle</td>
    </tr>
    <tr>
      <th>2917</th>
      <td>New York</td>
      <td>2015-12-27</td>
      <td>2.0</td>
      <td>17.2</td>
      <td>8.9</td>
      <td>5.5</td>
      <td>fog</td>
    </tr>
    <tr>
      <th>2918</th>
      <td>New York</td>
      <td>2015-12-28</td>
      <td>1.3</td>
      <td>8.9</td>
      <td>1.7</td>
      <td>6.3</td>
      <td>snow</td>
    </tr>
    <tr>
      <th>2919</th>
      <td>New York</td>
      <td>2015-12-29</td>
      <td>16.8</td>
      <td>9.4</td>
      <td>1.1</td>
      <td>5.3</td>
      <td>fog</td>
    </tr>
    <tr>
      <th>2920</th>
      <td>New York</td>
      <td>2015-12-30</td>
      <td>9.4</td>
      <td>10.6</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>fog</td>
    </tr>
    <tr>
      <th>2921</th>
      <td>New York</td>
      <td>2015-12-31</td>
      <td>1.5</td>
      <td>11.1</td>
      <td>6.1</td>
      <td>5.5</td>
      <td>fog</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Criaremos exibições de multivisualizações para examinar o clima dentro e fora das cidades.</p>
</section>
<section id="camada">
<h2>5.2 Camada<a class="headerlink" href="#camada" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>Uma das formas mais comuns de combinar vários gráficos é <em>sobrepor</em> marcas umas sobre as outras. Se os domínios das escalas subjacentes forem compatíveis, podemos mesclá-los para formar <em>eixos compartilhados</em>. Se uma das codificações em <code class="docutils literal notranslate"><span class="pre">x</span></code> ou <code class="docutils literal notranslate"><span class="pre">y</span></code> não for compatível, podemos, em vez disso, criar um gráfico de <em>eixos duplos</em>, que sobrepõe marcas usando escalas e eixos separados.</p>
<section id="eixos-compartilhados">
<h3>5.2.1 Eixos Compartilhados<a class="headerlink" href="#eixos-compartilhados" title="Link to this heading">#</a></h3>
<p>Vamos começar plotando as temperaturas médias mínima e máxima por mês:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y2</span><span class="p">(</span><span class="s1">&#39;average(temp_min):Q&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-ba99f2e6a4e94e398e2d7b76ab405061.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-ba99f2e6a4e94e398e2d7b76ab405061.vega-embed details,
  #altair-viz-ba99f2e6a4e94e398e2d7b76ab405061.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-ba99f2e6a4e94e398e2d7b76ab405061"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-ba99f2e6a4e94e398e2d7b76ab405061") {
      outputDiv = document.getElementById("altair-viz-ba99f2e6a4e94e398e2d7b76ab405061");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "mark": {"type": "area"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>O gráfico nos mostra os intervalos de temperatura para cada mês ao longo de todo o nosso conjunto de dados. No entanto, isso pode ser bastante enganoso, pois agrega as medições de Seattle e Nova York!</em></p>
<p>Vamos subdividir os dados por local usando uma codificação de cor e também ajustar a opacidade das marcas para acomodar as áreas sobrepostas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y2</span><span class="p">(</span><span class="s1">&#39;average(temp_min):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-9c662af5cbf540f294dc50481f66d613.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-9c662af5cbf540f294dc50481f66d613.vega-embed details,
  #altair-viz-9c662af5cbf540f294dc50481f66d613.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-9c662af5cbf540f294dc50481f66d613"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9c662af5cbf540f294dc50481f66d613") {
      outputDiv = document.getElementById("altair-viz-9c662af5cbf540f294dc50481f66d613");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>Podemos ver que Seattle tem um clima mais ameno: é mais quente no inverno e mais fresco no verão.</em></p>
<p>Neste caso, criamos um gráfico em camadas sem recursos especiais, apenas subdividindo as marcas de área por cor. Embora o gráfico acima nos mostre os intervalos de temperatura, também podemos querer enfatizar o ponto médio desse intervalo.</p>
<p>Vamos criar um gráfico de linhas mostrando a temperatura média intermediária. Para isso, usaremos uma transformação de cálculo (<code class="docutils literal notranslate"><span class="pre">calculate</span></code>) para determinar os pontos médios entre as temperaturas mínimas e máximas diárias:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
  <span class="n">temp_mid</span><span class="o">=</span><span class="s1">&#39;(+datum.temp_min + +datum.temp_max) / 2&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_mid):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-a1da62de277b47118210b4f0e911b3c7.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-a1da62de277b47118210b4f0e911b3c7.vega-embed details,
  #altair-viz-a1da62de277b47118210b4f0e911b3c7.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-a1da62de277b47118210b4f0e911b3c7"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-a1da62de277b47118210b4f0e911b3c7") {
      outputDiv = document.getElementById("altair-viz-a1da62de277b47118210b4f0e911b3c7");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>Observação</em>: note o uso de <code class="docutils literal notranslate"><span class="pre">+datum.temp_min</span></code> dentro da transformação de cálculo. Como estamos carregando os dados diretamente de um arquivo CSV sem nenhuma instrução especial de análise, os valores de temperatura podem estar internamente representados como strings. Adicionar o <code class="docutils literal notranslate"><span class="pre">+</span></code> antes do valor força sua interpretação como um número.</p>
<p>Agora, queremos combinar esses gráficos sobrepondo as linhas dos pontos médios às áreas de intervalo. Usando a sintaxe <code class="docutils literal notranslate"><span class="pre">chart1</span> <span class="pre">+</span> <span class="pre">chart2</span></code>, podemos especificar que queremos um novo gráfico em camadas em que <code class="docutils literal notranslate"><span class="pre">chart1</span></code> é a primeira camada e <code class="docutils literal notranslate"><span class="pre">chart2</span></code> é uma segunda camada desenhada por cima:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tempMinMax</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y2</span><span class="p">(</span><span class="s1">&#39;average(temp_min):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tempMid</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
  <span class="n">temp_mid</span><span class="o">=</span><span class="s1">&#39;(+datum.temp_min + +datum.temp_max) / 2&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_mid):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tempMinMax</span> <span class="o">+</span> <span class="n">tempMid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-22fafcee475d499f924c6e48a54d2f4a.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-22fafcee475d499f924c6e48a54d2f4a.vega-embed details,
  #altair-viz-22fafcee475d499f924c6e48a54d2f4a.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-22fafcee475d499f924c6e48a54d2f4a"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-22fafcee475d499f924c6e48a54d2f4a") {
      outputDiv = document.getElementById("altair-viz-22fafcee475d499f924c6e48a54d2f4a");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}], "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>Agora temos um gráfico em várias camadas! No entanto, o título do eixo y (embora informativo) ficou um pouco longo e desorganizado…</em></p>
<p>Vamos personalizar nossos eixos para melhorar a aparência do gráfico. Se definirmos um título personalizado para o eixo em uma das camadas, ele será automaticamente usado como título compartilhado para todas as camadas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tempMinMax</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%b&#39;</span><span class="p">)),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Avg. Temperature °C&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y2</span><span class="p">(</span><span class="s1">&#39;average(temp_min):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tempMid</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
  <span class="n">temp_mid</span><span class="o">=</span><span class="s1">&#39;(+datum.temp_min + +datum.temp_max) / 2&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_mid):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tempMinMax</span> <span class="o">+</span> <span class="n">tempMid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-ea2164f273594ab483631b5f61e686df.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-ea2164f273594ab483631b5f61e686df.vega-embed details,
  #altair-viz-ea2164f273594ab483631b5f61e686df.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-ea2164f273594ab483631b5f61e686df"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-ea2164f273594ab483631b5f61e686df") {
      outputDiv = document.getElementById("altair-viz-ea2164f273594ab483631b5f61e686df");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature \u00b0C", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}], "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>O que acontece se ambas as camadas tiverem títulos personalizados para o eixo? Modifique o código acima para descobrir…</em></p>
<p>Acima usamos o operador <code class="docutils literal notranslate"><span class="pre">+</span></code>, uma forma conveniente de escrever o método de camadas (<code class="docutils literal notranslate"><span class="pre">layer</span></code>) do Altair. Podemos gerar um gráfico em camadas idêntico usando diretamente o método <code class="docutils literal notranslate"><span class="pre">layer</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="n">tempMinMax</span><span class="p">,</span> <span class="n">tempMid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-4ae277ca4b2e46babcea59e7ef925221.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-4ae277ca4b2e46babcea59e7ef925221.vega-embed details,
  #altair-viz-4ae277ca4b2e46babcea59e7ef925221.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-4ae277ca4b2e46babcea59e7ef925221"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-4ae277ca4b2e46babcea59e7ef925221") {
      outputDiv = document.getElementById("altair-viz-4ae277ca4b2e46babcea59e7ef925221");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature \u00b0C", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}], "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>Observe que a ordem dos elementos em uma camada é importante, pois as camadas subsequentes serão desenhadas sobre as anteriores. <em>Tente trocar a ordem dos gráficos nas células acima. O que acontece? (Dica: preste atenção na cor das marcas de linha (<code class="docutils literal notranslate"><span class="pre">line</span></code>).)</em></p>
</section>
<section id="graficos-de-eixo-duplo">
<h3>5.2.2 Gráficos de Eixo Duplo<a class="headerlink" href="#graficos-de-eixo-duplo" title="Link to this heading">#</a></h3>
<p><em>Seattle tem a reputação de ser uma cidade chuvosa. Será que isso é merecido?</em></p>
<p>Vamos analisar a precipitação junto com a temperatura para entender melhor. Primeiro, vamos criar um gráfico básico que mostra a precipitação média mensal em Seattle:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
  <span class="n">interpolate</span><span class="o">=</span><span class="s1">&#39;monotone&#39;</span><span class="p">,</span>
  <span class="n">stroke</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(precipitation):Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Precipitation&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-9b560afc8a444ecc86c326652fe765c8.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-9b560afc8a444ecc86c326652fe765c8.vega-embed details,
  #altair-viz-9b560afc8a444ecc86c326652fe765c8.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-9b560afc8a444ecc86c326652fe765c8"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9b560afc8a444ecc86c326652fe765c8") {
      outputDiv = document.getElementById("altair-viz-9b560afc8a444ecc86c326652fe765c8");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "mark": {"type": "line", "interpolate": "monotone", "stroke": "grey"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "title": "Precipitation", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>Para facilitar a comparação com os dados de temperatura, vamos criar um novo gráfico em camadas (<em>layered chart</em>). Aqui está o que acontece se tentarmos sobrepor os gráficos da mesma forma que fizemos anteriormente:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tempMinMax</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%b&#39;</span><span class="p">)),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Avg. Temperature °C&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y2</span><span class="p">(</span><span class="s1">&#39;average(temp_min):Q&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">precip</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
  <span class="n">interpolate</span><span class="o">=</span><span class="s1">&#39;monotone&#39;</span><span class="p">,</span>
  <span class="n">stroke</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(precipitation):Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Precipitation&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="n">tempMinMax</span><span class="p">,</span> <span class="n">precip</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-60c8080aba1d4556bf2bff778e00130f.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-60c8080aba1d4556bf2bff778e00130f.vega-embed details,
  #altair-viz-60c8080aba1d4556bf2bff778e00130f.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-60c8080aba1d4556bf2bff778e00130f"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-60c8080aba1d4556bf2bff778e00130f") {
      outputDiv = document.getElementById("altair-viz-60c8080aba1d4556bf2bff778e00130f");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature \u00b0C", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}, {"mark": {"type": "line", "interpolate": "monotone", "stroke": "grey"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "title": "Precipitation", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}], "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>Os valores de precipitação utilizam um intervalo muito menor no eixo y do que as temperaturas!</em></p>
<p>Por padrão, gráficos em camadas (<em>layered charts</em>) utilizam um <code class="docutils literal notranslate"><span class="pre">domínio</span> <span class="pre">compartilhado</span></code>: os valores para o eixo x ou y são combinados entre todas as camadas para determinar uma extensão compartilhada. Esse comportamento padrão assume que os valores das camadas têm as mesmas unidades. No entanto, isso não se aplica a este exemplo, pois estamos combinando valores de temperatura (graus Celsius) com valores de precipitação (polegadas)!</p>
<p>Se quisermos usar escalas diferentes para o eixo y, precisamos especificar como desejamos que o Altair <em>resolva</em> os dados entre as camadas. Neste caso, queremos que os domínios das escalas (<code class="docutils literal notranslate"><span class="pre">scale</span></code>) do eixo y sejam independentes (<code class="docutils literal notranslate"><span class="pre">independent</span></code>), em vez de usar um domínio compartilhado (<code class="docutils literal notranslate"><span class="pre">shared</span></code>). O objeto <code class="docutils literal notranslate"><span class="pre">Chart</span></code> gerado por um operador de camada inclui um método <code class="docutils literal notranslate"><span class="pre">resolve_scale</span></code> (resolve escala) com o qual podemos especificar a resolução desejada.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tempMinMax</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%b&#39;</span><span class="p">)),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Avg. Temperature °C&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y2</span><span class="p">(</span><span class="s1">&#39;average(temp_min):Q&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">precip</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
  <span class="n">interpolate</span><span class="o">=</span><span class="s1">&#39;monotone&#39;</span><span class="p">,</span>
  <span class="n">stroke</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(precipitation):Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Precipitation&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="n">tempMinMax</span><span class="p">,</span> <span class="n">precip</span><span class="p">)</span><span class="o">.</span><span class="n">resolve_scale</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;independent&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-7e0f1fe6084847e0a1af49acc2a7f77d.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-7e0f1fe6084847e0a1af49acc2a7f77d.vega-embed details,
  #altair-viz-7e0f1fe6084847e0a1af49acc2a7f77d.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-7e0f1fe6084847e0a1af49acc2a7f77d"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-7e0f1fe6084847e0a1af49acc2a7f77d") {
      outputDiv = document.getElementById("altair-viz-7e0f1fe6084847e0a1af49acc2a7f77d");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature \u00b0C", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}, {"mark": {"type": "line", "interpolate": "monotone", "stroke": "grey"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "title": "Precipitation", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}], "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "resolve": {"scale": {"y": "independent"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>Agora podemos ver que o outono é a estação mais chuvosa em Seattle (com pico em novembro), complementado pelos verões secos.</em></p>
<p>Você pode ter notado certa redundância nas especificações do nosso gráfico acima: ambos usam o mesmo conjunto de dados e o mesmo filtro para exibir apenas Seattle. Se vocês quiser, você pode simplificar um pouco o código fornecendo os dados e a transformação de filtro para o gráfico em camadas (<em>layered chart</em>) de nível superior. As camadas individuais irão herdar os dados se não tiverem suas próprias definições de dados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tempMinMax</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%b&#39;</span><span class="p">)),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Avg. Temperature °C&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y2</span><span class="p">(</span><span class="s1">&#39;average(temp_min):Q&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">precip</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
  <span class="n">interpolate</span><span class="o">=</span><span class="s1">&#39;monotone&#39;</span><span class="p">,</span>
  <span class="n">stroke</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(precipitation):Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Precipitation&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="n">tempMinMax</span><span class="p">,</span> <span class="n">precip</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">resolve_scale</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;independent&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-9161d97f47d04eb7ac697131a2f69dce.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-9161d97f47d04eb7ac697131a2f69dce.vega-embed details,
  #altair-viz-9161d97f47d04eb7ac697131a2f69dce.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-9161d97f47d04eb7ac697131a2f69dce"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9161d97f47d04eb7ac697131a2f69dce") {
      outputDiv = document.getElementById("altair-viz-9161d97f47d04eb7ac697131a2f69dce");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature \u00b0C", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": {"type": "line", "interpolate": "monotone", "stroke": "grey"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "title": "Precipitation", "type": "quantitative"}}}], "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "resolve": {"scale": {"y": "independent"}}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>Embora gráficos de eixos duplos (<em>dual-axis charts</em>) possam ser úteis, <em>eles são frequentemente propensos a interpretações equivocadas</em>, pois as diferentes unidades e escalas dos eixos podem ser desproporcionais. Sempre que possível, você pode considerar transformações que mapeiem diferentes campos de dados para unidades compartilhadas, como, por exemplo, exibir <a class="reference external" href="https://en.wikipedia.org/wiki/Quantile">quantis</a> ou mudanças percentuais relativas.</p>
</section>
</section>
<section id="faceta">
<h2>5.3 Faceta<a class="headerlink" href="#faceta" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p><em>Facetar</em> envolve subdividir um dataset em grupos e criar um gráfico separado para cada grupo. Nos últimos capítulos, aprendemos como criar tabelas facetadas usando os canais de codificação <code class="docutils literal notranslate"><span class="pre">linha</span></code> e <code class="docutils literal notranslate"><span class="pre">coluna</span></code>. Vamos primeiro revisar esses canais e então mostrar como são instâncias de um operador mais geral: a <code class="docutils literal notranslate"><span class="pre">faceta</span></code>.</p>
<p>Comecemos com um histograma básico acerca dos níveis máximos da temperatura de Seattle:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;temp_max:Q&#39;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Temperature (°C)&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;count():Q&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-c9ec2351b43543c4b9025c466bbbec44.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-c9ec2351b43543c4b9025c466bbbec44.vega-embed details,
  #altair-viz-c9ec2351b43543c4b9025c466bbbec44.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-c9ec2351b43543c4b9025c466bbbec44"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-c9ec2351b43543c4b9025c466bbbec44") {
      outputDiv = document.getElementById("altair-viz-c9ec2351b43543c4b9025c466bbbec44");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "mark": {"type": "bar"}, "encoding": {"x": {"bin": true, "field": "temp_max", "title": "Temperature (\u00b0C)", "type": "quantitative"}, "y": {"aggregate": "count", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>Como o perfil de temperaturas buda com base no tempo de um dado dia - isto é, se chovia, garoava, nevava, fazia sol ou tempo nublado?</em></p>
<p>Vamos usar o canal de codificação <code class="docutils literal notranslate"><span class="pre">coluna</span></code> para facetar os dados por tipo de tempo atmosférico. Podemos também usar a <code class="docutils literal notranslate"><span class="pre">cor</span></code> como codificação redundante, usando um intervalo customizado:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
  <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;drizzle&#39;</span><span class="p">,</span> <span class="s1">&#39;fog&#39;</span><span class="p">,</span> <span class="s1">&#39;rain&#39;</span><span class="p">,</span> <span class="s1">&#39;snow&#39;</span><span class="p">,</span> <span class="s1">&#39;sun&#39;</span><span class="p">],</span>
  <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#aec7e8&#39;</span><span class="p">,</span> <span class="s1">&#39;#c7c7c7&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f77b4&#39;</span><span class="p">,</span> <span class="s1">&#39;#9467bd&#39;</span><span class="p">,</span> <span class="s1">&#39;#e7ba52&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;temp_max:Q&#39;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Temperature (°C)&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;count():Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;weather:N&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">colors</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;weather:N&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
  <span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
  <span class="n">height</span><span class="o">=</span><span class="mi">150</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-92a8befadb774eb3aad07f3089b1e94a.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-92a8befadb774eb3aad07f3089b1e94a.vega-embed details,
  #altair-viz-92a8befadb774eb3aad07f3089b1e94a.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-92a8befadb774eb3aad07f3089b1e94a"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-92a8befadb774eb3aad07f3089b1e94a") {
      outputDiv = document.getElementById("altair-viz-92a8befadb774eb3aad07f3089b1e94a");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "mark": {"type": "bar"}, "encoding": {"color": {"field": "weather", "scale": {"domain": ["drizzle", "fog", "rain", "snow", "sun"], "range": ["#aec7e8", "#c7c7c7", "#1f77b4", "#9467bd", "#e7ba52"]}, "type": "nominal"}, "column": {"field": "weather", "type": "nominal"}, "x": {"bin": true, "field": "temp_max", "title": "Temperature (\u00b0C)", "type": "quantitative"}, "y": {"aggregate": "count", "type": "quantitative"}}, "height": 150, "transform": [{"filter": "datum.location == \"Seattle\""}], "width": 150, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>Para a surpresa de ninguém, esses raros dias de neve centralizam as temperaturas mais baixas, seguidos por dias chuvosos e nublados. Dias de sol são mais quentes e, apesar dos estereótipos de Seattle, são os mais frequentes. Apesar de que, como qualquer morador de Seattle pode te informar, a garoa vem e volta a qualquer momento e a despeito da temperatura!</em></p>
<p>Adicionalmente aos canais de codificação <code class="docutils literal notranslate"><span class="pre">linha</span></code> e <code class="docutils literal notranslate"><span class="pre">coluna</span></code>, uma definição de tabelas, podemos usar definições básicas de tabela para aplicar facetamento através de um operador explícito de <code class="docutils literal notranslate"><span class="pre">faceta</span></code>.</p>
<p>Vamos recriar a tabela acima, mas dessa vez usando <code class="docutils literal notranslate"><span class="pre">faceta</span></code>. Começamos com algumas definições básicas de histograma, mas removemos a fonte das informações, filtro de transformação e canal coluna. Podemos então chamar o método <code class="docutils literal notranslate"><span class="pre">faceta</span></code> passando os dados e especificando que se deve facetar colunas de acordo com o campo <code class="docutils literal notranslate"><span class="pre">clima</span></code>. O método <code class="docutils literal notranslate"><span class="pre">faceta</span></code> aceita tanto <code class="docutils literal notranslate"><span class="pre">linha</span></code> quanto <code class="docutils literal notranslate"><span class="pre">coluna</span></code> como  argumentos. Ambos podem ser usados para criar uma grade 2d de gráficos facetados.</p>
<p>Por fim, incluímos nossos filtros de transformação, os apliccando ao gráfico da faceta superior (<em>faceted plots</em>). Poderíamos, é claro, aplicar o filtro de transformação à definição de histograma apresentada no início, mas isso seria sensivelmente menos eficiente. Melhor que filtrar valores de “Nova York” dentro de cada célula de faceta, aplicar o filtro ao gráfico facetado (<em>faceted plot</em>) permite que o Vega-Lite saiba que podemos filtrar esses valores antecipadamente, antes da divisão das facetas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
  <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;drizzle&#39;</span><span class="p">,</span> <span class="s1">&#39;fog&#39;</span><span class="p">,</span> <span class="s1">&#39;rain&#39;</span><span class="p">,</span> <span class="s1">&#39;snow&#39;</span><span class="p">,</span> <span class="s1">&#39;sun&#39;</span><span class="p">],</span>
  <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#aec7e8&#39;</span><span class="p">,</span> <span class="s1">&#39;#c7c7c7&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f77b4&#39;</span><span class="p">,</span> <span class="s1">&#39;#9467bd&#39;</span><span class="p">,</span> <span class="s1">&#39;#e7ba52&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;temp_max:Q&#39;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Temperature (°C)&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;count():Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;weather:N&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
  <span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
  <span class="n">height</span><span class="o">=</span><span class="mi">150</span>
<span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span>
  <span class="n">data</span><span class="o">=</span><span class="n">weather</span><span class="p">,</span>
  <span class="n">column</span><span class="o">=</span><span class="s1">&#39;weather:N&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-a2f3c397f32a4968898591f35705d610.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-a2f3c397f32a4968898591f35705d610.vega-embed details,
  #altair-viz-a2f3c397f32a4968898591f35705d610.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-a2f3c397f32a4968898591f35705d610"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-a2f3c397f32a4968898591f35705d610") {
      outputDiv = document.getElementById("altair-viz-a2f3c397f32a4968898591f35705d610");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "facet": {"column": {"field": "weather", "type": "nominal"}}, "spec": {"mark": {"type": "bar"}, "encoding": {"color": {"field": "weather", "scale": {"domain": ["drizzle", "fog", "rain", "snow", "sun"], "range": ["#aec7e8", "#c7c7c7", "#1f77b4", "#9467bd", "#e7ba52"]}, "type": "nominal"}, "x": {"bin": true, "field": "temp_max", "title": "Temperature (\u00b0C)", "type": "quantitative"}, "y": {"aggregate": "count", "type": "quantitative"}}, "height": 150, "width": 150}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>Dado todo o código extra acima, por quereríamos usar um operador explícito para <code class="docutils literal notranslate"><span class="pre">faceta</span></code>? Para gráficos básicos, deveríamos certamente usar os canais de codificação <code class="docutils literal notranslate"><span class="pre">coluna</span></code> ou <code class="docutils literal notranslate"><span class="pre">linha</span></code> sempre que possível. Usar o operador explícito <code class="docutils literal notranslate"><span class="pre">faceta</span></code>, entretanto, é útil se quisermos facetar visualizações compostas como gráficos em camadass.</p>
<p>Vamos revisitar nossas plotagens de temperatura em camadas usadas mais cedo. Ao invés de plotar dados de Nova York e Seattle no mesmo gráfico, os quebraremos em diferentes facetas. As definições de gráfico individual são basicamente as mesmas de antes: um gráfico de área e um gráfico de linha. A única diferença é que dessa vez não passaremos o dados diretamente para os construtores do gráfico; vamos esperar e passá-los para o operador faceta posteriormente. Podemos construir camadas de gráficos como antes e só então chamar o <code class="docutils literal notranslate"><span class="pre">faceta</span></code> para o objeto gráfico em camada, passando o dado e especificando facetas <code class="docutils literal notranslate"><span class="pre">coluna</span></code> com base no campo <code class="docutils literal notranslate"><span class="pre">localização</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tempMinMax</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%b&#39;</span><span class="p">)),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Avg. Temperature (°C)&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y2</span><span class="p">(</span><span class="s1">&#39;average(temp_min):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tempMid</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
  <span class="n">temp_mid</span><span class="o">=</span><span class="s1">&#39;(+datum.temp_min + +datum.temp_max) / 2&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_mid):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="n">tempMinMax</span><span class="p">,</span> <span class="n">tempMid</span><span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span>
  <span class="n">data</span><span class="o">=</span><span class="n">weather</span><span class="p">,</span>
  <span class="n">column</span><span class="o">=</span><span class="s1">&#39;location:N&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-b582c23631cd4ebaa4b2a80b8304a535.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-b582c23631cd4ebaa4b2a80b8304a535.vega-embed details,
  #altair-viz-b582c23631cd4ebaa4b2a80b8304a535.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-b582c23631cd4ebaa4b2a80b8304a535"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-b582c23631cd4ebaa4b2a80b8304a535") {
      outputDiv = document.getElementById("altair-viz-b582c23631cd4ebaa4b2a80b8304a535");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "facet": {"column": {"field": "location", "type": "nominal"}}, "spec": {"layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}]}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>Os gráficos facetados que vimos até agora usam os mesmos domínios de escala e eixos através nas células facetadas. Esse padrão de usar escalas e eixos <em>compartilhados</em> ajuda a auxiliar na comparação precisa de valores. No entanto, em alguns casos, você pode querer dimensionar cada gráfico independentemente, por exemplo, se o intervalo de valores nas células diferir significativamente.</p>
<p>Semelhante aos gráficos em camadas, os gráficos facetados também oferecem suporte à <em>resolução</em> para escalas ou eixos independentes nos gráficos. Vamos ver o que acontece se chamarmos o método <code class="docutils literal notranslate"><span class="pre">resolve_axis</span></code> para solicitar eixos y <code class="docutils literal notranslate"><span class="pre">independentes</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tempMinMax</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%b&#39;</span><span class="p">)),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Avg. Temperature (°C)&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y2</span><span class="p">(</span><span class="s1">&#39;average(temp_min):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tempMid</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
  <span class="n">temp_mid</span><span class="o">=</span><span class="s1">&#39;(+datum.temp_min + +datum.temp_max) / 2&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_mid):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="n">tempMinMax</span><span class="p">,</span> <span class="n">tempMid</span><span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span>
  <span class="n">data</span><span class="o">=</span><span class="n">weather</span><span class="p">,</span>
  <span class="n">column</span><span class="o">=</span><span class="s1">&#39;location:N&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">resolve_axis</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;independent&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-9b43d6d244084171baae90a6866e891a.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-9b43d6d244084171baae90a6866e891a.vega-embed details,
  #altair-viz-9b43d6d244084171baae90a6866e891a.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-9b43d6d244084171baae90a6866e891a"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9b43d6d244084171baae90a6866e891a") {
      outputDiv = document.getElementById("altair-viz-9b43d6d244084171baae90a6866e891a");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "facet": {"column": {"field": "location", "type": "nominal"}}, "spec": {"layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}]}, "resolve": {"axis": {"y": "independent"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>O gráfico acima não parece ter sofrido grandes mudanças, mas o plot de Seattle agora inclui seu próprio eixo.</em></p>
<p>E se ao invés disso chamássemos <code class="docutils literal notranslate"><span class="pre">resolve_scale</span></code> para solucionar os domínios de escala subjacentes?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tempMinMax</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%b&#39;</span><span class="p">)),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Avg. Temperature (°C)&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y2</span><span class="p">(</span><span class="s1">&#39;average(temp_min):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tempMid</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
  <span class="n">temp_mid</span><span class="o">=</span><span class="s1">&#39;(+datum.temp_min + +datum.temp_max) / 2&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_mid):Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;location:N&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="n">tempMinMax</span><span class="p">,</span> <span class="n">tempMid</span><span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span>
  <span class="n">data</span><span class="o">=</span><span class="n">weather</span><span class="p">,</span>
  <span class="n">column</span><span class="o">=</span><span class="s1">&#39;location:N&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">resolve_scale</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;independent&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-f4bcd0e6d6a8417aa39ea9f8012461ef.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-f4bcd0e6d6a8417aa39ea9f8012461ef.vega-embed details,
  #altair-viz-f4bcd0e6d6a8417aa39ea9f8012461ef.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-f4bcd0e6d6a8417aa39ea9f8012461ef"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-f4bcd0e6d6a8417aa39ea9f8012461ef") {
      outputDiv = document.getElementById("altair-viz-f4bcd0e6d6a8417aa39ea9f8012461ef");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "facet": {"column": {"field": "location", "type": "nominal"}}, "spec": {"layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}]}, "resolve": {"scale": {"y": "independent"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>Vemos agora células facetadas com diferentes eixos e domínios de escala. Nesse caso, usar escalas independentes parece uma ideia ruim! Os domínios não tem diferença que o justifica, e o observador pode ser induzido ao erro de achar que Nova York e Seattle tem temperaturas máximas semelhantes no verão.</em></p>
<p>Para tomar um clicê emprestado: só poruque você <em>pode</em> fazer algo, não significa que <em>deveria</em>…</p>
</section>
<section id="concatenacao">
<h2>5.4 Concatenação<a class="headerlink" href="#concatenacao" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>A técnica de faceting cria <a class="reference external" href="https://en.wikipedia.org/wiki/Small_multiple">múltiplos gráficos pequenos</a> que mostram subdivisões separadas do dado. No entanto, podemos desejar criar uma exibição de multivisualização com diferentes perspectivas do <em>mesmo</em> conjunto de dados (não mais subconjuntos) ou visualizações que envolvem conjuntos de dados <em>distintos</em>.</p>
<p>O Altair oferece operadores de <em>concatenação</em> para combinar gráficos arbitrários em um único gráfico concatenado. O operador <code class="docutils literal notranslate"><span class="pre">hconcat</span></code> (abreviando, <code class="docutils literal notranslate"><span class="pre">|</span></code> ) realiza uma concatenação horizontal, enquanto o operador <code class="docutils literal notranslate"><span class="pre">vconcat</span></code> (abreviando, <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>) realiza uma concatenação vertical.</p>
<p>Vamos começar com um gráfico de linha simples, mostrando a média da temperatura máxima por mês em Nova York e Seattle, conforme vimos anteriormente:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">),</span>
  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;location:N&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-f007b07f298e4a4fad8c2c81276363ad.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-f007b07f298e4a4fad8c2c81276363ad.vega-embed details,
  #altair-viz-f007b07f298e4a4fad8c2c81276363ad.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-f007b07f298e4a4fad8c2c81276363ad"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-f007b07f298e4a4fad8c2c81276363ad") {
      outputDiv = document.getElementById("altair-viz-f007b07f298e4a4fad8c2c81276363ad");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>E se quisermos comparar não apenas a temperatura ao longo do tempo, mas também os níveis de precipitação e ventos?</em></p>
<p>Vamos criar um gráfico concatenado composto por três visualizações. Vamos começar definindo um gráfico “base”  que contém todos os aspectos que devem ser compartilhados pelas três visualizações. Podemos, então, modificar esta base para criar variantes customizadas, com diferentes codificações do eixo y para as variáveis de temperatura máxima (<code class="docutils literal notranslate"><span class="pre">temp_max</span></code>), precipitação (<code class="docutils literal notranslate"><span class="pre">precipitation</span></code>) e ventos (<code class="docutils literal notranslate"><span class="pre">wind</span></code>). A seguir, concatenamos as visualizações usando o operador abreviado da barra vertical ( <code class="docutils literal notranslate"><span class="pre">|</span></code> ):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;location:N&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
  <span class="n">width</span><span class="o">=</span><span class="mi">240</span><span class="p">,</span>
  <span class="n">height</span><span class="o">=</span><span class="mi">180</span>
<span class="p">)</span>

<span class="n">temp</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">))</span>
<span class="n">precip</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(precipitation):Q&#39;</span><span class="p">))</span>
<span class="n">wind</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(wind):Q&#39;</span><span class="p">))</span>

<span class="n">temp</span> <span class="o">|</span> <span class="n">precip</span> <span class="o">|</span> <span class="n">wind</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-e507177b5ac5485e8ae1e14ee9c1e49f.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-e507177b5ac5485e8ae1e14ee9c1e49f.vega-embed details,
  #altair-viz-e507177b5ac5485e8ae1e14ee9c1e49f.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-e507177b5ac5485e8ae1e14ee9c1e49f"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-e507177b5ac5485e8ae1e14ee9c1e49f") {
      outputDiv = document.getElementById("altair-viz-e507177b5ac5485e8ae1e14ee9c1e49f");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "hconcat": [{"mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "height": 180, "width": 240}, {"mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "type": "quantitative"}}, "height": 180, "width": 240}, {"mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "wind", "type": "quantitative"}}, "height": 180, "width": 240}], "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>Poderíamos também utilizar o método mais explícito <code class="docutils literal notranslate"><span class="pre">alt.hconcat()</span></code> no lugar da barra vertical <code class="docutils literal notranslate"><span class="pre">|</span></code> . <em>Tente reescrever o código acima usando</em> <code class="docutils literal notranslate"><span class="pre">hconcat</span></code>.</p>
<p>A concatenação vertical funciona de forma similar à concatenação horizontal. <em>Usando o operador <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> (ou o método</em> <code class="docutils literal notranslate"><span class="pre">alt.vconcat</span></code>)<em>, modifique o código para ordenar as visualizações verticalmente ao invés de horizontalmente.</em></p>
<p>Finalmente, note que as concatenações horizontais e verticais podem ser combinadas. <em>O que acontece se você escrever algo como</em> <code class="docutils literal notranslate"><span class="pre">(temp</span> <span class="pre">|</span> <span class="pre">precip)</span> <span class="pre">&amp;</span> <span class="pre">wind</span></code> <em>?</em></p>
<p><em>Observação:</em> Note a importância desses parênteses… O que aconteceria se você os removesse? Mantenha em mente que esses operadores sobrecarregados ainda estão sujeitos às <a class="reference external" href="https://docs.python.org/3/reference/expressions.html#operator-precedence">regras de precedência de operadores do Python</a>, e assim, a concatenação vertical com <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> vai ter preferência sobre a concatenação horizontal com <code class="docutils literal notranslate"><span class="pre">|</span></code> !</p>
<p>Como veremos mais tarde, os operadores de concatenação permitem combinar quaisquer gráficos em um dashboard de multivisualização!</p>
</section>
<section id="repeticao">
<h2>5.5 Repetição<a class="headerlink" href="#repeticao" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>Os operadores de concatenação são genéricos, permitindo a composição de gráficos arbitrários. No entanto, o exemplo acima ainda possui palavras demais: temos três gráficos muito semelhantes, mas precisamos defini-los separadamente e depois concatená-los.</p>
<p>Para casos em que apenas uma ou duas variáveis estão mudando, o operador <code class="docutils literal notranslate"><span class="pre">repeat</span></code> proporciona um atalho útil para criar múltiplos gráficos. Dada uma especificação de <em>modelo</em> com algumas variáveis livres, o operador <code class="docutils literal notranslate"><span class="pre">repeat</span></code> criará um gráfico para cada atribuição especificada dessas variáveis.</p>
<p>Vamos recriar o exemplo de concatenação acima usando o operador <code class="docutils literal notranslate"><span class="pre">repeat</span></code>. O único aspecto que difere entre as visualizações é a escolha da variável para a codificação do eixo <code class="docutils literal notranslate"><span class="pre">y</span></code>. Para criar uma especificação de modelo, podemos usar a <em>variável repetitiva</em> <code class="docutils literal notranslate"><span class="pre">alt.repeat('column')</span></code> como o nosso eixo y. Esse código simplesmente indica que queremos usar a variável atribuída à coluna repetida, a qual organiza os gráficos repetidos na direção horizontal. (Como o método fornece apenas o nome do campo, temos que especificar o tipo dos dados separadamente com <code class="docutils literal notranslate"><span class="pre">type='quantitative'</span></code> .)</p>
<p>Em seguida, invocamos o método <code class="docutils literal notranslate"><span class="pre">repeat</span></code>, passando os nomes dos campos de dados para cada coluna:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;column&#39;</span><span class="p">),</span> <span class="n">aggregate</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;quantitative&#39;</span><span class="p">),</span>
  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;location:N&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
  <span class="n">width</span><span class="o">=</span><span class="mi">240</span><span class="p">,</span>
  <span class="n">height</span><span class="o">=</span><span class="mi">180</span>
<span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
  <span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;temp_max&#39;</span><span class="p">,</span> <span class="s1">&#39;precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;wind&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-32d5624c707f4aa48d95fc440628360c.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-32d5624c707f4aa48d95fc440628360c.vega-embed details,
  #altair-viz-32d5624c707f4aa48d95fc440628360c.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-32d5624c707f4aa48d95fc440628360c"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-32d5624c707f4aa48d95fc440628360c") {
      outputDiv = document.getElementById("altair-viz-32d5624c707f4aa48d95fc440628360c");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "repeat": {"column": ["temp_max", "precipitation", "wind"]}, "spec": {"data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "mark": {"type": "line"}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": {"repeat": "column"}, "type": "quantitative"}}, "height": 180, "width": 240}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>A repetição pode ser feita tanto nas colunas quanto nas linhas. O que acontece se você modificar o código acima para usar linhas (</em><code class="docutils literal notranslate"><span class="pre">row</span></code><em>) ao invés de colunas (</em><code class="docutils literal notranslate"><span class="pre">column</span></code><em>)?</em></p>
<p>Podemos também usar a repetição de linha (<code class="docutils literal notranslate"><span class="pre">row</span></code>) e de coluna (<code class="docutils literal notranslate"><span class="pre">column</span></code>) juntas! Uma visualização comum para exploração de análise de dados é a <a class="reference external" href="https://pt.wikipedia.org/wiki/Gr%C3%A1fico_de_dispers%C3%A3o">matriz de gráfico de dispersão</a> (ou SPLOM, abreviação do termo em inglês ‘scatter plot matrix’). Dada uma coleção de variáveis para inspecionar, a SPLOM proporciona uma grade com todos os gráficos pareados dessas variáveis, nos permitindo enxergar possíveis correlações.</p>
<p>Vamos usar o operador <code class="docutils literal notranslate"><span class="pre">repeat</span></code> para criar uma SPLOM para os campos <code class="docutils literal notranslate"><span class="pre">temp_max</span></code>, <code class="docutils literal notranslate"><span class="pre">precipitation</span></code> e <code class="docutils literal notranslate"><span class="pre">wind</span></code>. Primeiramente, vamos criar a nossa especificação de modelo, com variáveis repetidas para os campos do eixo x e do eixo y.  A seguir, invocamos <code class="docutils literal notranslate"><span class="pre">repeat</span></code>, passando vetores de nomes de campos para usar tanto na linha (<code class="docutils literal notranslate"><span class="pre">row</span></code>) quanto na coluna (<code class="docutils literal notranslate"><span class="pre">column</span></code>). O Altair vai, então, gerar o <a class="reference external" href="https://pt.wikipedia.org/wiki/Produto_cartesiano"> produto cruzado (ou o produto Cartesiano)</a> para criar o espaço completo de gráficos repetidos:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;column&#39;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;quantitative&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;quantitative&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
  <span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
  <span class="n">height</span><span class="o">=</span><span class="mi">150</span>
<span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
  <span class="n">data</span><span class="o">=</span><span class="n">weather</span><span class="p">,</span>
  <span class="n">row</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;temp_max&#39;</span><span class="p">,</span> <span class="s1">&#39;precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;wind&#39;</span><span class="p">],</span>
  <span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;wind&#39;</span><span class="p">,</span> <span class="s1">&#39;precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_max&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-570a18d420024c5eb39527a5cbb4ca53.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-570a18d420024c5eb39527a5cbb4ca53.vega-embed details,
  #altair-viz-570a18d420024c5eb39527a5cbb4ca53.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-570a18d420024c5eb39527a5cbb4ca53"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-570a18d420024c5eb39527a5cbb4ca53") {
      outputDiv = document.getElementById("altair-viz-570a18d420024c5eb39527a5cbb4ca53");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "repeat": {"column": ["wind", "precipitation", "temp_max"], "row": ["temp_max", "precipitation", "wind"]}, "spec": {"mark": {"type": "point", "filled": true, "opacity": 0.5, "size": 15}, "encoding": {"x": {"field": {"repeat": "column"}, "type": "quantitative"}, "y": {"field": {"repeat": "row"}, "type": "quantitative"}}, "height": 150, "width": 150}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p><em>Analisando essas visualizações, parece que não há uma correlação forte entre precipitação e ventos, apesar de notarmos que eventos com fortes ventos e precipitação ocorrem em intervalos similares de máxima temperatura (~5-15° C). Contudo, essa observação não é muito surpreendente: relembrando o histograma feito no começo da seção de facet, podemos ver claramente que os dias com máximas temperaturas no intervalo de 5-15°C são os mais frequentes.</em></p>
<p><em>Modifique o código acima para conseguir uma melhor compreensão da repetição de gráficos. Tente adicionar outra variável (</em><code class="docutils literal notranslate"><span class="pre">temp_min</span></code><em>) para a SPLOM. O que acontece se você rearranjar a ordem dos campos em algum dos parâmetros de linha (</em><code class="docutils literal notranslate"><span class="pre">row</span></code><em>) ou coluna (</em><code class="docutils literal notranslate"><span class="pre">column</span></code><em>) para o operador</em> <code class="docutils literal notranslate"><span class="pre">repeat</span></code><em>?</em></p>
<p><em>Finalmente, para realmente apreciar tudo que o operador</em><code class="docutils literal notranslate"><span class="pre">repeat</span></code> <em>pode oferecer, reserve um momento para imaginar como você pode recriar a SPLOM acima usando apenas</em> <code class="docutils literal notranslate"><span class="pre">hconcat</span></code> <em>e</em> <code class="docutils literal notranslate"><span class="pre">vconcat</span></code><em>!</em></p>
</section>
<section id="algebra-de-composicao-de-visualizacoes">
<h2>5.6 Álgebra de Composição de Visualizações<a class="headerlink" href="#algebra-de-composicao-de-visualizacoes" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>Juntos, os operados <code class="docutils literal notranslate"><span class="pre">layer</span></code>, <code class="docutils literal notranslate"><span class="pre">facet</span></code>, <code class="docutils literal notranslate"><span class="pre">concat</span></code> e <code class="docutils literal notranslate"><span class="pre">repeat</span></code> formam uma <em>álgebra de composição de visualizações</em>: diversos operadores podem ser combinados para construir uma variedade de visualizações múltiplas.</p>
<p>Como exemplo, vamos começar com dois gráficos básicos: um histograma e uma linha simples (uma única marca <code class="docutils literal notranslate"><span class="pre">rule</span></code>) mostrando uma média global.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">basic1</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):O&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">basic2</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">stroke</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;average(temp_max):Q&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">basic1</span> <span class="o">|</span> <span class="n">basic2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-8cc25c4e29724da1a9b5f0d9399f2fc7.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-8cc25c4e29724da1a9b5f0d9399f2fc7.vega-embed details,
  #altair-viz-8cc25c4e29724da1a9b5f0d9399f2fc7.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-8cc25c4e29724da1a9b5f0d9399f2fc7"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-8cc25c4e29724da1a9b5f0d9399f2fc7") {
      outputDiv = document.getElementById("altair-viz-8cc25c4e29724da1a9b5f0d9399f2fc7");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "hconcat": [{"mark": {"type": "bar"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "type": "ordinal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}, {"mark": {"type": "rule", "stroke": "firebrick"}, "encoding": {"y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}], "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>Podemos então combinar os dois gráficos usando um operador <code class="docutils literal notranslate"><span class="pre">layer</span></code> e, em seguida, <code class="docutils literal notranslate"> <span class="pre">repeat</span></code>, que repetiria esse gráfico em camadas para mostrar histogramas com médias sobrepostas para vários campos:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):O&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Month&#39;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;column&#39;</span><span class="p">),</span> <span class="n">aggregate</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;quantitative&#39;</span><span class="p">)</span>
  <span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">stroke</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;column&#39;</span><span class="p">),</span> <span class="n">aggregate</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;quantitative&#39;</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
  <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
  <span class="n">height</span><span class="o">=</span><span class="mi">150</span>
<span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
  <span class="n">data</span><span class="o">=</span><span class="n">weather</span><span class="p">,</span>
  <span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;temp_max&#39;</span><span class="p">,</span> <span class="s1">&#39;precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;wind&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-052e3eba74d844feb7ff3b078072ead9.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-052e3eba74d844feb7ff3b078072ead9.vega-embed details,
  #altair-viz-052e3eba74d844feb7ff3b078072ead9.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-052e3eba74d844feb7ff3b078072ead9"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-052e3eba74d844feb7ff3b078072ead9") {
      outputDiv = document.getElementById("altair-viz-052e3eba74d844feb7ff3b078072ead9");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "repeat": {"column": ["temp_max", "precipitation", "wind"]}, "spec": {"layer": [{"mark": {"type": "bar"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "title": "Month", "type": "ordinal"}, "y": {"aggregate": "average", "field": {"repeat": "column"}, "type": "quantitative"}}}, {"mark": {"type": "rule", "stroke": "firebrick"}, "encoding": {"y": {"aggregate": "average", "field": {"repeat": "column"}, "type": "quantitative"}}}], "height": 150, "width": 200}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>Se focarmos apenas nos operadores de composição de múltiplas visualizações, o modelo para a visualização acima é:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">repeat</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>
<span class="o">|-</span> <span class="n">layer</span>
   <span class="o">|-</span> <span class="n">basic1</span>
   <span class="o">|-</span> <span class="n">basic2</span>
</pre></div>
</div>
<p>Agora, vamos explorar como podemos aplicar todos os operadores em um <a class="reference external" href="https://en.wikipedia.org/wiki/Dashboard_(computing)">painel</a> final que fornece uma visão geral do clima de Seattle. Combinaremos os displays SPLOM e histograma facetado das seções anteriores com os histogramas repetidos acima:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">splom</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;column&#39;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;quantitative&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;quantitative&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
  <span class="n">width</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span>
  <span class="n">height</span><span class="o">=</span><span class="mi">125</span>
<span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
  <span class="n">row</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;temp_max&#39;</span><span class="p">,</span> <span class="s1">&#39;precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;wind&#39;</span><span class="p">],</span>
  <span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;wind&#39;</span><span class="p">,</span> <span class="s1">&#39;precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_max&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">dateHist</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month(date):O&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Month&#39;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">),</span> <span class="n">aggregate</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;quantitative&#39;</span><span class="p">)</span>
  <span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">stroke</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">),</span> <span class="n">aggregate</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;quantitative&#39;</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
  <span class="n">width</span><span class="o">=</span><span class="mi">175</span><span class="p">,</span>
  <span class="n">height</span><span class="o">=</span><span class="mi">125</span>
<span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
  <span class="n">row</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;temp_max&#39;</span><span class="p">,</span> <span class="s1">&#39;precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;wind&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">tempHist</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;temp_max:Q&#39;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Temperature (°C)&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;count():Q&#39;</span><span class="p">),</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;weather:N&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
    <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;drizzle&#39;</span><span class="p">,</span> <span class="s1">&#39;fog&#39;</span><span class="p">,</span> <span class="s1">&#39;rain&#39;</span><span class="p">,</span> <span class="s1">&#39;snow&#39;</span><span class="p">,</span> <span class="s1">&#39;sun&#39;</span><span class="p">],</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#aec7e8&#39;</span><span class="p">,</span> <span class="s1">&#39;#c7c7c7&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f77b4&#39;</span><span class="p">,</span> <span class="s1">&#39;#9467bd&#39;</span><span class="p">,</span> <span class="s1">&#39;#e7ba52&#39;</span><span class="p">]</span>
  <span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
  <span class="n">width</span><span class="o">=</span><span class="mi">115</span><span class="p">,</span>
  <span class="n">height</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span>
  <span class="n">column</span><span class="o">=</span><span class="s1">&#39;weather:N&#39;</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">vconcat</span><span class="p">(</span>
  <span class="n">alt</span><span class="o">.</span><span class="n">hconcat</span><span class="p">(</span><span class="n">splom</span><span class="p">,</span> <span class="n">dateHist</span><span class="p">),</span>
  <span class="n">tempHist</span><span class="p">,</span>
  <span class="n">data</span><span class="o">=</span><span class="n">weather</span><span class="p">,</span>
  <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Seattle Weather Dashboard&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
  <span class="s1">&#39;datum.location == &quot;Seattle&quot;&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">resolve_legend</span><span class="p">(</span>
  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;independent&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">configure_axis</span><span class="p">(</span>
  <span class="n">labelAngle</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-fec24529d8144c8192510c5a9384c148.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-fec24529d8144c8192510c5a9384c148.vega-embed details,
  #altair-viz-fec24529d8144c8192510c5a9384c148.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-fec24529d8144c8192510c5a9384c148"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-fec24529d8144c8192510c5a9384c148") {
      outputDiv = document.getElementById("altair-viz-fec24529d8144c8192510c5a9384c148");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "axis": {"labelAngle": 0}}, "vconcat": [{"hconcat": [{"repeat": {"column": ["wind", "precipitation", "temp_max"], "row": ["temp_max", "precipitation", "wind"]}, "spec": {"mark": {"type": "point", "filled": true, "opacity": 0.5, "size": 15}, "encoding": {"x": {"field": {"repeat": "column"}, "type": "quantitative"}, "y": {"field": {"repeat": "row"}, "type": "quantitative"}}, "height": 125, "width": 125}}, {"repeat": {"row": ["temp_max", "precipitation", "wind"]}, "spec": {"layer": [{"mark": {"type": "bar"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "title": "Month", "type": "ordinal"}, "y": {"aggregate": "average", "field": {"repeat": "row"}, "type": "quantitative"}}}, {"mark": {"type": "rule", "stroke": "firebrick"}, "encoding": {"y": {"aggregate": "average", "field": {"repeat": "row"}, "type": "quantitative"}}}], "height": 125, "width": 175}}]}, {"facet": {"column": {"field": "weather", "type": "nominal"}}, "spec": {"mark": {"type": "bar"}, "encoding": {"color": {"field": "weather", "scale": {"domain": ["drizzle", "fog", "rain", "snow", "sun"], "range": ["#aec7e8", "#c7c7c7", "#1f77b4", "#9467bd", "#e7ba52"]}, "type": "nominal"}, "x": {"bin": true, "field": "temp_max", "title": "Temperature (\u00b0C)", "type": "quantitative"}, "y": {"aggregate": "count", "type": "quantitative"}}, "height": 100, "width": 115}}], "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@1/data/weather.csv"}, "resolve": {"legend": {"color": "independent"}}, "title": "Seattle Weather Dashboard", "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>O modelo de composição completo para este painel é:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vconcat</span>
<span class="o">|-</span> <span class="n">hconcat</span>
<span class="o">|</span>  <span class="o">|-</span> <span class="n">repeat</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|-</span> <span class="n">splom</span> <span class="n">base</span> <span class="n">chart</span>
<span class="o">|</span>  <span class="o">|-</span> <span class="n">repeat</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>
<span class="o">|</span>     <span class="o">|-</span> <span class="n">layer</span>
<span class="o">|</span>        <span class="o">|-</span> <span class="n">dateHist</span> <span class="n">base</span> <span class="n">chart</span> <span class="mi">1</span>
<span class="o">|</span>        <span class="o">|-</span> <span class="n">dateHist</span> <span class="n">base</span> <span class="n">chart</span> <span class="mi">2</span>
<span class="o">|-</span> <span class="n">facet</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;weather&#39;</span><span class="p">)</span>
   <span class="o">|-</span> <span class="n">tempHist</span> <span class="n">base</span> <span class="n">chart</span>
</pre></div>
</div>
<p>Ufa! O painel também inclui algumas personalizações para melhorar o layout:</p>
<ul class="simple">
<li><p>Ajustamos o gráfico com as propriedades <code class="docutils literal notranslate"><span class="pre">width</span></code> e <code class="docutils literal notranslate"><span class="pre">height</span></code> para auxiliar o alinhamento e garantir que a visualização completa caiba na tela.</p></li>
<li><p>Adicionamos <code class="docutils literal notranslate"><span class="pre">resolve_legend(color='independent')</span></code> para garantir que a legenda de cores seja associada diretamente aos histogramas coloridos por temperatura. Caso contrário, a legenda resolverá para o painel como um todo.</p></li>
<li><p>Usamos <code class="docutils literal notranslate"><span class="pre">configure_axis(labelAngle=0)</span></code> para garantir que nenhum rótulo de eixo seja rotacionado. Isso ajuda a garantir o alinhamento adequado entre os gráficos de dispersão (<em>scatter plots</em>) no SPLOM e os histogramas por mês à direita.</p></li>
</ul>
<p><em>Tente remover ou modificar qualquer um desses ajustes e veja como o layout do painel responde!</em></p>
<p>Este painel pode ser reutilizado para mostrar dados de outros locais ou de outros conjuntos de dados. <em>Atualize o painel para mostrar padrões climáticos para Nova York em vez de Seattle.</em></p>
</section>
<section id="resumo">
<h2>5.7 Resumo<a class="headerlink" href="#resumo" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>Para obter mais detalhes sobre a composição de múltiplas visualizações, incluindo controle sobre espaçamento de subplotagens e rótulos de cabeçalho, consulte a <a class="reference external" href="https://altair-viz.github.io/user_guide/compound_charts.html">documentação do Altair Compound Charts</a>.</p>
<p>Agora que vimos como compor múltiplas visualizações, estamos prontos para colocá-las em ação. Além de apresentar dados estaticamente, múltiplas visualizações podem permitir exploração multidimensional interativa. Por exemplo, usando seleções vinculadas , podemos destacar pontos em uma visualização para ver valores correspondentes destacados em outras visualizações.</p>
<p>No próximo capítulo, examinaremos como criar seleções interativas para plotagens individuais e composições com múltiplas visualizações.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./_sources\content\curriculum"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dados-meteorologicos">5.1 Dados Meteorológicos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#camada">5.2 Camada</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eixos-compartilhados">5.2.1 Eixos Compartilhados</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graficos-de-eixo-duplo">5.2.2 Gráficos de Eixo Duplo</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#faceta">5.3 Faceta</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concatenacao">5.4 Concatenação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#repeticao">5.5 Repetição</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#algebra-de-composicao-de-visualizacoes">5.6 Álgebra de Composição de Visualizações</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resumo">5.7 Resumo</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>